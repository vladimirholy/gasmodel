---
title: "Case Study: Bookshop Orders"
author: "Vladimír Holý"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Case Study: Bookshop Orders}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.align = "center",
  fig.width = 6,
  fig.height = 4,
  out.width = "75%"
)

options(
  width = 100,
  max.print = 1e3,
  pillar.print_max = 1e3
)

Sys.setlocale("LC_ALL", "en_US.UTF-8")
```

## Data Preparation

```{r packages, warning = FALSE, message = FALSE, results = "hide"}
library(tidyverse)
library(gasmodel)
```

``` {r data, fig.width = 6, fig.height = 4}
data_dur <- bookshop_sales %>%
  mutate(duration = as.numeric(time - lag(time)) / 60) %>%
  mutate(duration = recode(duration, "0" = 0.5)) %>%
  mutate(just_time = as.vector(as.POSIXct(format(time, format = "1970-01-01 %H:%M:%S")))) %>%
  drop_na()


model_spline <- smooth.spline(data_dur$just_time, data_dur$duration, df = 5)
plot(model_spline, type = "l")

data_dur <- data_dur %>%
  mutate(duration_spline = predict(model_spline, x = just_time)$y) %>%
  mutate(duration_adj = duration / duration_spline) %>%
  select(-just_time)

```

``` {r variables}
y <- data_dur$duration_adj
```

## Model Estimation

``` {r distr}
distr(filter_type = "duration", filter_dim = "uni", filter_default = TRUE)[, 1:3]
```

``` {r exp}
exp_est <- gas(y = y, distr = "exp")
exp_est
```

``` {r weibull}
weibull_est <- gas(y = y, distr = "weibull", par_static = c(FALSE, TRUE))
weibull_est
```

``` {r gamma}
gamma_est <- gas(y = y, distr = "gamma", par_static = c(FALSE, TRUE))
gamma_est
```

``` {r gengamma}
gengamma_est <- gas(y = y, distr = "gengamma", par_static = c(FALSE, TRUE, TRUE))
gengamma_est
```

``` {r aic}
AIC(exp_est, weibull_est, gamma_est, gengamma_est)
```
